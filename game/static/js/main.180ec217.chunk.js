(this.webpackJsonpbig_enemy=this.webpackJsonpbig_enemy||[]).push([[0],{114:function(e,t,r){e.exports=r(263)},256:function(e,t,r){},262:function(e,t,r){},263:function(e,t,r){"use strict";r.r(t);var a=r(0),o=r.n(a),s=r(31),n=r.n(s),i=r(2),l=r(8),c=(r(118),r(256),r(10)),u=r(1),d={maxSpeed:70,accel:10,friction:.2,brakeCoef:1,bounceK:.5,rotateSpeed:u.Math.degToRad(90),skiddingC:.8,radiusPerBall:1.5,minBubbleRadius:2,maxBallsCount:7,bulletRadius:2,bRadiusCoef:2,fieldW:350,fieldH:250,radIncrease:4,gateWidth:15.5,shot:{reloadingTime:8,gravity:250,speed:170,angle:u.Math.degToRad(60)},bubbleColors:["#DB4A4A","#54915F"],bulletColors:["#DB4A4A","#54915F"],crossHairColors:["#ff0088","#00ff2e"]},p={1:{moveDir:new u.Vector3(0,1,0),lookDir:new u.Vector3(-1,0,0),position:new u.Vector3(100,0,0),balls:d.maxBallsCount,shots:d.maxBallsCount,shotsReloading:[],curSpeed:0},2:{moveDir:new u.Vector3(0,1,0),lookDir:new u.Vector3(1,0,0),position:new u.Vector3(-100,0,0),balls:d.maxBallsCount,shots:d.maxBallsCount,shotsReloading:[],curSpeed:0}},f={players:{1:{},2:{}},bullets:[],keysPressed:{1:{left:!1,right:!1,up:!1,down:!1,shot:!1},2:{left:!1,right:!1,up:!1,down:!1,shot:!1}},score:[0,0]};function y(e){var t=p[e];Object.keys(t).forEach((function(r){var a=t[r],o=a.constructor===u.Vector3?a.clone():a;f.players[e][r]=o}))}function m(e){return d.minBubbleRadius+e*d.radiusPerBall}y(1),y(2);var h=function(e){switch(e.keyCode){case 13:return void(f.keysPressed[1].shot=!0);case 39:return void(f.keysPressed[1].right=!0);case 37:return void(f.keysPressed[1].left=!0);case 38:return void(f.keysPressed[1].up=!0);case 40:return void(f.keysPressed[1].down=!0);case 84:return void(f.keysPressed[2].shot=!0);case 68:return void(f.keysPressed[2].right=!0);case 65:return void(f.keysPressed[2].left=!0);case 87:return void(f.keysPressed[2].up=!0);case 83:return void(f.keysPressed[2].down=!0);default:return}},b=function(e){switch(e.keyCode){case 39:return void(f.keysPressed[1].right=!1);case 37:return void(f.keysPressed[1].left=!1);case 38:return void(f.keysPressed[1].up=!1);case 40:return void(f.keysPressed[1].down=!1);case 68:return void(f.keysPressed[2].right=!1);case 65:return void(f.keysPressed[2].left=!1);case 87:return void(f.keysPressed[2].up=!1);case 83:return void(f.keysPressed[2].down=!1);default:return}},v=r(108),g=r.n(v);function E(e,t,r){var a=f.keysPressed[e],o=a.right,s=a.left,n=a.up,i=a.down,l=d.maxSpeed,p=d.accel,h=d.friction,b=d.rotateSpeed,v=d.skiddingC,g=f.players[e].curSpeed;if(o&&f.players[e].lookDir.applyEuler(new u.Euler(0,0,-b*t)),s&&f.players[e].lookDir.applyEuler(new u.Euler(0,0,b*t)),n){var E=f.players[e],w=E.lookDir,O=E.moveDir;if(g+p<=l&&(f.players[e].curSpeed+=p*t),w.angleTo(O)<.02)f.players[e].moveDir.copy(w);else{var j=g<10?1:v*t;f.players[e].moveDir.lerp(w,j)}}else if(i){var k=f.players[e].curSpeed*d.brakeCoef*t;f.players[e].curSpeed-k<0||k<.01?f.players[e].curSpeed=0:f.players[e].curSpeed-=k}else if(!n&&!i){var S=f.players[e].curSpeed*h*t;f.players[e].curSpeed-S<0||S<.01?f.players[e].curSpeed=0:f.players[e].curSpeed-=S}var P=f.players[e],M=P.position,x=P.moveDir,B=m(P.balls);g=f.players[e].curSpeed;var C=d.fieldW/2,R=-C,W=d.fieldH/2,V=-W,D=M.x+g*t*x.x;D+B<C&&D-B>R?f.players[e].position.setX(D):B<=d.minBubbleRadius+4*d.radiusPerBall&&f.players[e].position.y+B<d.gateWidth/2&&f.players[e].position.y-B>-d.gateWidth/2?f.players[e].position.setX(D):(f.players[e].moveDir.x*=-1,f.players[e].curSpeed*=d.bounceK);var H=M.y+g*t*x.y;H+B<W&&H-B>V?f.players[e].position.setY(H):(f.players[e].moveDir.y=-f.players[e].moveDir.y,f.players[e].curSpeed*=d.bounceK);var T=new u.Box2(new u.Vector2(-d.fieldW/2-40,-30),new u.Vector2(-d.fieldW/2-1,30)),I=f.players[e].position,G=new u.Vector2(I.x,I.y);T.containsPoint(G)&&(f.score[e-1]++,r(Object(c.a)(f.score)),console.log("Player ".concat(e," win!")),y(1),y(2))}function w(e,t){f.keysPressed[e].shot=!1;var r=f.players[e],a=r.position,o=r.lookDir,s=r.shots,n=r.balls;if(!(s<=0)){var i=n-d.maxBallsCount,l=i<0?0:i*d.bRadiusCoef;f.bullets.push({id:g()(),startPos:a.clone(),startTime:performance.now(),position:a.clone(),dir:o.clone(),playerId:e,stale:!1,radius:d.bulletRadius+l}),f.players[e].shots-=1,f.players[e].shotsReloading.push(d.shot.reloadingTime),t()}}function O(e,t){var r=f.players[e].shotsReloading;f.players[e].shotsReloading=r.map((function(r){var a=r-t;return a<=0&&(f.players[e].shots+=1),a})).filter((function(e){return e>=0}))}var j=performance.now(),k=function(e,t){return function(r){var a=(r-j)/1e3;j=r,E(1,a,t),E(2,a,t),O(1,a),O(2,a),f.keysPressed[1].shot&&w(1,e),f.keysPressed[2].shot&&w(2,e);var o=!1;f.bullets=f.bullets.filter((function(e){return!(e.position.z+d.bulletRadius<-200)||(o=!0,!1)})),f.bullets.forEach((function(e,t){!function(e,t){var r=d.shot,a=r.speed,o=r.angle,s=r.gravity,n=f.bullets[e],i=n.startTime,l=n.startPos,c=(t-i)/1e3,u=n.dir.clone().multiplyScalar(a*Math.cos(o)*c);f.bullets[e].position=l.clone().add(u),f.bullets[e].position.z=a*Math.sin(o)*c-s*c*c/2}(t,r),!e.stale&&function(e,t){var r=e.position.clone(),a=e.radius,o=f.players[t].position.clone(),s=m(f.players[t].balls);if(o.distanceTo(r)<s+a){var n=e.playerId;f.players[t].balls+=1,f.players[t].shots+=1,f.players[n].balls-=1,f.players[n].shots-=1;var i=f.players[t],l=m(i.balls);if(i.position.x+l>=d.fieldW/2){var c=Math.abs(d.fieldW/2-(i.position.x+l));f.players[t].position.x-=c+.1}else if(i.position.x-l<=-d.fieldW/2){var u=Math.abs(d.fieldW/2+(i.position.x-l));f.players[t].position.x+=u+.1}if(i.position.y+l>=d.fieldH/2){var p=Math.abs(d.fieldH/2-(i.position.y+l));f.players[t].position.y-=p+.1}else if(i.position.y-l<=-d.fieldH/2){var y=Math.abs(d.fieldH/2+(i.position.y-l));f.players[t].position.y+=y+.1}e.stale=!0}}(e,1===e.playerId?2:1)})),o&&e()}},S=o.a.memo((function(e){var t=e.color,r=d.shot,s=r.speed,n=r.gravity,i=r.angle,c=s*s/n*Math.sin(2*i),p=Object(a.useRef)();return Object(l.c)((function(){p.current.rotation.z+=.04})),o.a.createElement("mesh",{position:[c,0,1],rotation:[0,0,u.Math.degToRad(-90)],ref:p},o.a.createElement("octahedronBufferGeometry",{attach:"geometry",args:[2,0]}),o.a.createElement("meshBasicMaterial",{attach:"material",color:t,transparent:!0,opacity:"0.8",wireframe:!0}))}));function P(e){var t=e.pId,r=Object(a.useRef)(),s=Object(a.useRef)(f.players[t].balls),n=Object(a.useState)(m(s.current)),c=Object(i.a)(n,2),p=c[0],y=c[1],h=d.bubbleColors,b=d.crossHairColors;return Object(l.c)((function(){var e=r.current,a=f.players[t],o=a.lookDir,n=a.position;if(e.quaternion.setFromUnitVectors(new u.Vector3(1,0,0),o.clone().normalize()),e.position.copy(n),f.players[t].balls!==s.current){s.current=f.players[t].balls;var i=m(s.current);y(i)}})),o.a.createElement("group",{ref:r},o.a.createElement("mesh",{receiveShadow:!0},o.a.createElement("sphereGeometry",{attach:"geometry",args:[p,32,32]}),o.a.createElement("meshLambertMaterial",{attach:"material",color:h[t-1]})),o.a.createElement("mesh",{position:[p+3,0,0],rotation:[0,0,u.Math.degToRad(-90)]},o.a.createElement("coneBufferGeometry",{attach:"geometry",args:[2,4,15]}),o.a.createElement("meshBasicMaterial",{attach:"material",color:h[t-1],transparent:!0,opacity:"0.5"})),o.a.createElement(S,{color:b[t-1]}))}function M(){return o.a.createElement("mesh",{position:[0,0,0],receiveShadow:!0},o.a.createElement("planeGeometry",{attach:"geometry",args:[window.innerWidth,window.innerHeight,32]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"#1781a4"}))}function x(e){var t=e.pId,r=e.id,s=Object(a.useState)(f.bullets[r].position),n=Object(i.a)(s,1)[0],c=Object(a.useRef)(),u=Object(a.useRef)(f.bullets[r].radius),p=Object(a.useState)(f.bullets[r].radius),y=Object(i.a)(p,2),m=y[0],h=y[1];return Object(l.c)((function(){var e=c.current,a=f.bullets[r].position;e.position.copy(a),f.bullets[r].radius!==u.current&&(u.current=f.players[t].balls,h(u.current))})),o.a.createElement("mesh",{ref:c,position:n,castShadow:!0,receiveShadow:!1},o.a.createElement("sphereGeometry",{attach:"geometry",args:[m,32,32]}),o.a.createElement("meshLambertMaterial",{attach:"material",color:d.bulletColors[t-1]}))}var B=r(113),C=function(e,t){return Math.random()*(t-e)+e},R=d.fieldW,W=d.fieldH,V=function(){return[C(-R/1.5,R/1.5),C(-W/1.5,W/1.5),.1]};function D(){var e=Object(a.useState)({position:V(),size:Math.floor(3*Math.random())+1}),t=Object(i.a)(e,2),r=t[0],s=t[1],n=Object(a.useState)(Math.abs(Math.random()-.2)),c=Object(i.a)(n,2),d=c[0],p=c[1],f=Object(a.useState)(d),y=Object(i.a)(f,1)[0],m=Object(a.useState)(0),h=Object(i.a)(m,2),b=h[0],v=h[1],g=Object(a.useState)(!0),E=Object(i.a)(g,2),w=E[0],O=E[1];return Object(l.c)((function(e,t){var a=1/((y<.4?8:3)/t);w&&b<0?(p(0),s(Object(B.a)({},r,{position:V()})),O(0),v(b+a)):!w&&b>y?(p(y),O(1),v(b-a)):(p(b),v(b+(w?-a:a)))})),o.a.createElement("mesh",{position:r.position,rotation:[0,0,u.Math.degToRad(-90)]},o.a.createElement("circleGeometry",{attach:"geometry",args:[r.size,6]}),o.a.createElement("meshBasicMaterial",{attach:"material",color:"#ffffff",transparent:!0,opacity:d}))}function H(e){var t=e.start,r=e.end,s=e.negOffset,n=void 0!==s&&s,i=e.gate,l=void 0!==i&&i,c=Object(a.useRef)();Object(a.useEffect)((function(){var e=c.current,a=r.clone().sub(t).normalize(),o=new u.Vector3(1,0,0);e.quaternion.setFromUnitVectors(o,a);var s=d.gateWidth/2;e.geometry.translate(l?s:0,n?-2.5:2.5,0)}),[r,t,n,l]);var p=r.distanceTo(t)+10*(l?1:2);return o.a.createElement("mesh",{ref:c,position:t.clone().lerp(r,.5)},o.a.createElement("boxBufferGeometry",{attach:"geometry",args:[p,5,4]}),o.a.createElement("meshStandardMaterial",{attach:"material",color:"#e1eaed"}))}var T=o.a.memo((function(){var e=new u.Vector3(-d.fieldW/2,d.fieldH/2,0),t=new u.Vector3(d.fieldW/2,d.fieldH/2,0),r=new u.Vector3(d.fieldW/2,-d.fieldH/2,0),a=new u.Vector3(-d.fieldW/2,-d.fieldH/2,0),s=new u.Vector3(-d.fieldW/2,-d.gateWidth/2,0),n=new u.Vector3(-d.fieldW/2,d.gateWidth/2,0);return o.a.createElement(o.a.Fragment,null,o.a.createElement(H,{start:e,end:t}),o.a.createElement(H,{start:t,end:r}),o.a.createElement(H,{start:a,end:r,negOffset:!0}),o.a.createElement(H,{start:n,end:e,gate:!0}),o.a.createElement(H,{start:s,end:a,gate:!0,negOffset:!0}))}));function I(e){var t=e.bullet,r=Object(a.useState)({opacity:.6,r1:t.radius,r2:t.radius+.8}),s=Object(i.a)(r,2),n=s[0],c=s[1],u=Object(a.useState)({opacity:.6,r1:t.radius,r2:t.radius+.8}),d=Object(i.a)(u,2),p=d[0],f=d[1],y=Object(a.useState)(!1),m=Object(i.a)(y,2),h=m[0],b=m[1],v=Object(a.useState)(null),g=Object(i.a)(v,2),E=g[0],w=g[1];return Object(l.c)((function(e,r){if(!(t.position.z>-10)&&(E||w({x:t.position.x,y:t.position.y}),b(!0),!(r<=0||p.opacity<=0))){var a=1/(.6/r),o=1/(.6/r),s=n.opacity,i=n.r1,l=n.r2,u=p.opacity,d=p.r1,y=p.r2;c({opacity:s-a,r1:i+a+.2,r2:l+a+.2}),n.opacity<.3&&f({opacity:u-o,r1:d+o,r2:y+o})}})),h?o.a.createElement("group",{position:[E.x,E.y,.1]},o.a.createElement("mesh",null,o.a.createElement("ringGeometry",{attach:"geometry",args:[n.r1,n.r2,24,1]}),o.a.createElement("meshBasicMaterial",{attach:"material",color:"#ffffff",opacity:n.opacity,transparent:!0})),o.a.createElement("mesh",null,o.a.createElement("ringGeometry",{attach:"geometry",args:[p.r1,p.r2,24,1]}),o.a.createElement("meshBasicMaterial",{attach:"material",color:"#ffffff",opacity:p.opacity,transparent:!0}))):null}var G=["red","lightgreen"];function z(e){var t=e.score;return o.a.createElement("div",{className:"score"},o.a.createElement("h1",{className:"score__text"},"Score: ",o.a.createElement("span",{style:{color:G[1]}},t[1])," / ",o.a.createElement("span",{style:{color:G[0]}},t[0])))}r(262);var L=function(){var e=Object(a.useState)(d),t=Object(i.a)(e,2),r=t[0],s=(t[1],Object(a.useState)([0,0])),n=Object(i.a)(s,2),c=n[0],u=n[1],p=function(){var e=Object(a.useState)(),t=Object(i.a)(e,2)[1];return Object(a.useCallback)((function(){return t({})}),[])}();return Object(a.useEffect)((function(){for(var e in r)d[e]=r[e]}),[r]),Object(a.useEffect)((function(){Object(l.b)(k(p,u)),window.addEventListener("keyup",b),window.addEventListener("keydown",h)}),[]),o.a.createElement("div",null,o.a.createElement(l.a,{style:{height:window.innerHeight},camera:{fov:30,position:[0,-400,340]},onCreated:function(e){return e.camera.lookAt(0,0,0)},shadowMap:!0},o.a.createElement("ambientLight",{intensity:.1}),o.a.createElement("pointLight",{position:[0,0,160],intensity:.4,castShadow:!0,distance:360}),o.a.createElement("hemisphereLight",{skyColor:"0xffffff",groundColor:"#888888",intensity:.7}),o.a.createElement("directionalLight",{position:[0,0,200],intensity:.5}),o.a.createElement(M,{color:r.colorSurf}),o.a.createElement(P,{pId:1,color:r.color1}),o.a.createElement(P,{pId:2,color:r.color2}),f.bullets.map((function(e,t){return o.a.createElement(x,{key:e.id,id:t,pId:e.playerId})})),f.bullets.map((function(e,t){return o.a.createElement(I,{key:e.id+1,bullet:e})})),Array.from(Array(20)).map((function(e,t){return o.a.createElement(D,{key:t})})),o.a.createElement(T,null)),o.a.createElement(z,{score:c}))};n.a.render(o.a.createElement(L,null),document.getElementById("root"))}},[[114,1,2]]]);
//# sourceMappingURL=main.180ec217.chunk.js.map